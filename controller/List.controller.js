sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/odata/v2/ODataModel"],function(e,t,a,i,l,o,r){"use strict";var s,n,u,d,p,g,c,h,m;m="/OData_Provisioning/sap/opu/odata/sap/ZPRICE_REPORT_SRV";return e.extend("sg.report.zprice.controller.List",{onInit:function(){n=this;n.getDistChannel()},getDistChannel:function(e){d=this.getView().byId("idSalesOrg").getValue();var t=[];if(d){t.push(new sap.ui.model.Filter("SalesOrg",o.EQ,d))}var a=new sap.m.ComboBox("idDistChannel");var i=new sap.ui.core.Item({cells:[new sap.m.Text({key:"{DistChannel}",text:"{DistChannel}"})]});a.bindAggregation("items",{path:"/DistChannelF4Set",template:i,filters:t})},oSoldPopup:null,handleSoldTo:function(e){if(!n.oSoldPopup){var t;var l=[];var s=new r(m,true);n.oSoldPopup=new sap.ui.xmlfragment("sg.report.zprice.fragments.dialog",n);d=this.getView().byId("idSalesOrg").getValue();p=this.getView().byId("idDistChannel").getValue();l.push(new sap.ui.model.Filter("SalesOrg",o.EQ,d));l.push(new sap.ui.model.Filter("DistChannel",o.EQ,p));s.read("/SoldToF4Set",{filters:l,success:function(e){t=e;n.oSoldPopup.setTitle("Sold To");n.oSoldPopup.setContentWidth("250px");n.oSoldPopup.attachConfirm(n.SoldToSelectionFinish,n);n.oSoldPopup.attachLiveChange(n.SoldToSearch,n);n.oSoldPopup.attachCancel(n.SoldToSelectionCancel,n);n.oSoldPopup.addStyleClass("sapUiSizeCompact");n.getView().addDependent(n.oSoldPopup);var a=new i(t);n.oSoldPopup.setModel(a);n.oSoldPopup.bindAggregation("items",{path:"/results",template:new sap.m.StandardListItem({title:"{Customer}",description:"{Name1}"})});n.oSoldPopup.open()},error:function(e){a.show(JSON.parse(e.responseText).error.message.value,{icon:a.Icon.ERROR,title:"Error Message",actions:[a.Action.OK]})}})}},SoldToSearch:function(e){var t=e.getParameter("value");var a=[];if(t!==null){var i=new sap.ui.model.Filter("Customer",o.Contains,t);a.push(i);var l=new sap.ui.model.Filter("Name1",o.Contains,t);a.push(l);var r=new sap.ui.model.Filter({filters:a,and:false});e.getSource().getBinding("items").filter([r])}},SoldToSelectionFinish:function(e){var t=e.getParameter("selectedItem").getTitle();n.getView().byId("idSoldTo").setValue(t);e.getSource().getBinding("items").filter([]);n.oSoldPopup=undefined},SoldToSelectionCancel:function(){n.oSoldPopup=undefined},oShipPupup:null,handleShipTo:function(e){var l;if(!this.oShipPopup){var r=[];var s=new sap.ui.model.odata.ODataModel(m,true);d=this.getView().byId("idSalesOrg").getValue();p=this.getView().byId("idDistChannel").getValue();g=this.getView().byId("idSoldTo").getValue();if(g===""){u="Enter Sold To";t.show(u);return}r.push(new sap.ui.model.Filter("SalesOrg",o.EQ,d));r.push(new sap.ui.model.Filter("DistChannel",o.EQ,p));r.push(new sap.ui.model.Filter("Customer",o.EQ,g));var c=new sap.m.StandardListItem({title:"{Customer}",description:"{Name1}"});s.read("/ShipToF4Set",{filters:r,success:function(e){l=e;n._valueHelpDialogShipTo=new sap.m.SelectDialog({title:"Ship To",contentWidth:"250px",liveChange:[n._valueHelpShipToSearch,n],confirm:[n.handleSelectionFinishShipTo,n]}).addStyleClass("sapUiSizeCompact");var t=new i(l);n._valueHelpDialogShipTo.setModel(t);n._valueHelpDialogShipTo.bindAggregation("items","/results",c);n._valueHelpDialogShipTo.open()},error:function(e){a.show(JSON.parse(e.responseText).error.message.value,{icon:a.Icon.ERROR,title:"Error Message",actions:[a.Action.OK]})}})}},handleMaterial:function(e){var l;var s=new r(m,true);d=this.getView().byId("idSalesOrg").getValue();p=this.getView().byId("idDistChannel").getValue();var g=[];if(d){g.push(new sap.ui.model.Filter("SalesOrg",o.EQ,d))}if(p){g.push(new sap.ui.model.Filter("DistChannel",o.EQ,p))}else{u="Enter Dist. Channel";t.show(u);return}var c=new sap.m.StandardListItem({title:"{MaterialCode}",description:"{MaterialDesc}"});s.read("/MaterialF4Set",{filters:g,success:function(e){l=e;var t=[];var a=n.getView().byId("idMaterial");var o=a.getTokens();for(var r=0;r<o.length;r++){var s=o[r].getText();var u=o[r].getKey();t.push({MaterialCode:u,MaterialDesc:s})}var d=[],p=[],g=[];for(var h=0;h<l.results.length;h++){var m=0;for(var r=0;r<t.length;r++){if(t[r].MaterialCode==l.results[h].Material)m=1}if(m==1){var S={MaterialCode:l.results[h].Material,MaterialDesc:l.results[h].Description};d.push(S)}else{var v={MaterialCode:l.results[h].Material,MaterialDesc:l.results[h].Description};p.push(v)}}g=d.concat(p);var f=new i;f.setData(g);n._valueHelpDialog=new sap.m.SelectDialog({styleClass:"sapUiSizeCompact",title:"Material",contentWidth:"250px",growingScrollToLoad:true,multiSelect:true,customData:[new sap.ui.core.CustomData({key:"{MaterialCode}",value:"{MaterialDesc}"})],liveChange:[n._valueHelpMaterialSearch,n],confirm:[n.handleSelectionFinish,n]}).addStyleClass("sapUiSizeCompact");n._valueHelpDialog.setModel(f);n._valueHelpDialog.bindAggregation("items","/",c);n._valueHelpDialog._oList.attachEventOnce("updateFinished",function(e){a.removeAllTokens();for(var i=0;i<t.length;i++){var l=t[i].MaterialCode;var o=t[i].MaterialDesc;var r=n._valueHelpDialog._list;a.addToken(new sap.m.Token({key:l,text:o}));for(var s=0;s<r.getItems().length;s++){var u=r.getItems()[s].getTitle();var d=r.getItems()[s].getDescription();if(l===d)r.getItems()[s].setSelected(true)}}});n._valueHelpDialog.open()},error:function(e){a.show(JSON.parse(e.responseText).error.message.value,{icon:a.Icon.ERROR,title:"Error Message",actions:[a.Action.OK]})}})},_valueHelpMaterialSearch:function(e){var t=e.getParameter("value");var a=[];if(t!==null){var i=new sap.ui.model.Filter("MaterialCode",o.Contains,t);a.push(i);var l=new sap.ui.model.Filter("MaterialDesc",o.Contains,t);a.push(l);var r=new sap.ui.model.Filter({filters:a,and:false});e.getSource().getBinding("items").filter([r])}},handleSelectionFinish:function(e){var t=[];var a=n.getView().byId("idMaterial");a.removeAllTokens();var i=e.getParameters("selectedItems").selectedItems;for(var l=0;l<i.length;l++){var o=i[l].getTitle();var r=i[l].getDescription();a.addToken(new sap.m.Token({key:r,text:o}));t.push(o)}e.getSource().getBinding("items").filter([])},_valueHelpSoldToSearch:function(e){var t=e.getParameter("value");var a=[];if(t!==null){var i=new sap.ui.model.Filter("Customer",o.Contains,t);a.push(i);var l=new sap.ui.model.Filter("Name1",o.Contains,t);a.push(l);var r=new sap.ui.model.Filter({filters:a,and:false});e.getSource().getBinding("items").filter([r])}},handleSelectionFinishSoldTo:function(e){var t=e.getParameter("selectedItem").getTitle();n.getView().byId("idSoldTo").setValue(t);e.getSource().getBinding("items").filter([])},_valueHelpShipToSearch:function(e){var t=e.getParameter("value");var a=[];if(t!==null){var i=new sap.ui.model.Filter("Customer",o.Contains,t);a.push(i);var l=new sap.ui.model.Filter("Name1",o.Contains,t);a.push(l);var r=new sap.ui.model.Filter({filters:a,and:false});e.getSource().getBinding("items").filter([r])}},handleSelectionFinishShipTo:function(e){var t=e.getParameter("selectedItem").getTitle();n.getView().byId("idShipTo").setValue(t);e.getSource().getBinding("items").filter([])},onSearch:function(e){s=this.getView().byId("idMaterial").getTokens();if(s===""||s===null){u="Material no. is mandatory";t.show(u);return}h=this.getView().byId("idDatePicker").getValue();if(h===""){u="Date is mandatory";t.show(u);return}d=this.getView().byId("idSalesOrg").getValue();if(d===""){u="Sales Org. is mandatory";t.show(u);return}p=this.getView().byId("idDistChannel").getValue();if(p===""){u="Distrubution Channel is mandatory";t.show(u);return}c=this.getView().byId("idSoldTo").getValue();if(c===""){u="Sold-To-Party is mandatory";t.show(u);return}g=this.getView().byId("idShipTo").getValue();var i=[];if(p){i.push(new sap.ui.model.Filter("DistChannel",o.EQ,p))}if(g){i.push(new sap.ui.model.Filter("ShipTo",o.EQ,g))}if(c){i.push(new sap.ui.model.Filter("SoldTo",o.EQ,c))}if(h){i.push(new sap.ui.model.Filter("Date",o.EQ,h))}if(s){for(var l=0;l<s.length;l++){i.push(new sap.ui.model.Filter("Material",o.EQ,s[l].getText()))}}var n=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{Material}"}),new sap.m.Text({text:"{CodeType}"}),new sap.m.Text({text:"{CustomerOrBranch}"}),new sap.m.Text({text:"{Price}"}),new sap.m.Text({text:"{Unit}"})]});var S=this.getView().byId("tblOutput");S.destroyItems();var v=new r(m,true);v.read("/OutputListSet",{context:{},urlParamters:{},async:true,filters:i,sorters:[],success:function(e){S.bindItems("/OutputListSet",n,null,i)},error:function(e){a.show(JSON.parse(e.responseText).error.message.value,{icon:a.Icon.ERROR,title:"Error Message",actions:[a.Action.OK]})}})}})});